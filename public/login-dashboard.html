<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - WeValid Dashboard</title>
    <link rel="icon" type="image/png" href="/perfume_icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
        }

        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
</head>

<body class="min-h-screen flex">
    <!-- Left Side - Brand -->
    <div class="hidden lg:flex lg:w-1/2 gradient-bg text-white items-center justify-center p-12">
        <div class="max-w-md">
            <div class="flex items-center gap-4 mb-8">
                <img src="/perfume_icon.png" alt="WeValid" class="w-20 h-20 invert">
                <div>
                    <h1 class="text-4xl font-bold">WeValid</h1>
                    <p class="text-blue-200 text-lg">Dashboard de Gestão</p>
                </div>
            </div>
            <p class="text-xl text-blue-100 leading-relaxed">
                Informações, serviços e funcionalidades essenciais para a operação da Rede de Franquias das marcas do
                Grupo Boticário.
            </p>
        </div>
    </div>

    <!-- Right Side - Login Form -->
    <div class="w-full lg:w-1/2 flex items-center justify-center p-8 bg-slate-50">
        <div class="w-full max-w-md">
            <!-- Mobile Logo -->
            <div class="lg:hidden flex items-center justify-center gap-3 mb-8">
                <img src="/perfume_icon.png" alt="WeValid" class="w-12 h-12">
                <h1 class="text-2xl font-bold text-slate-800">WeValid Dashboard</h1>
            </div>

            <div class="bg-white rounded-2xl shadow-xl p-8">
                <h2 class="text-2xl font-bold text-slate-800 mb-2">Boas-vindas</h2>
                <p class="text-slate-600 mb-8">
                    Informações, serviços e funcionalidades essenciais para a operação da Rede de Franquias.
                </p>

                <form id="loginForm" class="space-y-6">
                    <!-- Email Input -->
                    <div>
                        <label for="email" class="block text-sm font-medium text-slate-700 mb-2">
                            Email
                        </label>
                        <input type="email" id="email" placeholder="seuemail@exemplo.com.br" required
                            class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all" />
                    </div>

                    <!-- Password Input -->
                    <div>
                        <label for="password" class="block text-sm font-medium text-slate-700 mb-2">
                            Senha
                        </label>
                        <div class="relative">
                            <input type="password" id="password" placeholder="••••••••" required
                                class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all" />
                            <button type="button" onclick="togglePassword()"
                                class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600">
                                <span class="material-symbols-outlined" id="eyeIcon">visibility</span>
                            </button>
                        </div>
                        <a href="/reset-password" class="text-sm text-blue-600 hover:text-blue-700 mt-2 inline-block">
                            Esqueceu sua senha?
                        </a>
                    </div>

                    <!-- Error Message -->
                    <div id="errorMessage" class="hidden p-4 bg-red-50 border border-red-200 rounded-lg">
                        <p class="text-sm text-red-600 flex items-center gap-2">
                            <span class="material-symbols-outlined text-lg">error</span>
                            <span id="errorText"></span>
                        </p>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" id="loginButton"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors flex items-center justify-center gap-2">
                        <span id="buttonText">ENTRAR</span>
                        <span id="buttonSpinner" class="hidden">
                            <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                    stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor"
                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                </path>
                            </svg>
                        </span>
                    </button>
                </form>

                <!-- Footer Links -->
                <div class="mt-6 text-center">
                    <p class="text-sm text-slate-600">
                        Não tem acesso?
                        <a href="/" class="text-blue-600 hover:text-blue-700 font-medium">
                            Solicitar acesso
                        </a>
                    </p>
                </div>
            </div>

            <!-- Additional Info -->
            <div class="mt-6 text-center">
                <p class="text-xs text-slate-500">
                    © 2024 WeValid. Todos os direitos reservados.
                </p>
            </div>
        </div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        const SUPABASE_URL = 'https://acensrxfxzqozakkklmy.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFjZW5zcnhmeHpxb3pha2trbG15Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2ODc2NDUsImV4cCI6MjA3OTI2MzY0NX0.rRsWLCmIcoyKkE5Qh_et53wO_xzLriOjrsfU0Rs85Lo';
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Check if already logged in
        const { data: { session } } = await supabase.auth.getSession();
        if (session) {
            window.location.href = '/dashboard.html';
        }

        // Toggle password visibility
        window.togglePassword = function () {
            const passwordInput = document.getElementById('password');
            const eyeIcon = document.getElementById('eyeIcon');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeIcon.textContent = 'visibility_off';
            } else {
< !DOCTYPE html >
                    <html lang="pt-BR">

                        <head>
                            <meta charset="UTF-8">
                                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                                    <title>Login - WeValid Dashboard</title>
                                    <link rel="icon" type="image/png" href="/perfume_icon.png">
                                        <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
        }

        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
    </head>

    <body class="min-h-screen flex">
        <!-- Left Side - Brand -->
        <div class="hidden lg:flex lg:w-1/2 gradient-bg text-white items-center justify-center p-12">
            <div class="max-w-md">
                <div class="flex items-center gap-4 mb-8">
                    <img src="/perfume_icon.png" alt="WeValid" class="w-20 h-20 invert">
                    <div>
                        <h1 class="text-4xl font-bold">WeValid</h1>
                        <p class="text-blue-200 text-lg">Dashboard de Gestão</p>
                    </div>
                </div>
                <p class="text-xl text-blue-100 leading-relaxed">
                    Informações, serviços e funcionalidades essenciais para a operação da Rede de Franquias das marcas
                    do
                    Grupo Boticário.
                </p>
            </div>
        </div>

        <!-- Right Side - Login Form -->
        <div class="w-full lg:w-1/2 flex items-center justify-center p-8 bg-slate-50">
            <div class="w-full max-w-md">
                <!-- Mobile Logo -->
                <div class="lg:hidden flex items-center justify-center gap-3 mb-8">
                    <img src="/perfume_icon.png" alt="WeValid" class="w-12 h-12">
                    <h1 class="text-2xl font-bold text-slate-800">WeValid Dashboard</h1>
                </div>

                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <h2 class="text-2xl font-bold text-slate-800 mb-2">Boas-vindas</h2>
                    <p class="text-slate-600 mb-8">
                        Informações, serviços e funcionalidades essenciais para a operação da Rede de Franquias.
                    </p>

                    <form id="loginForm" class="space-y-6">
                        <!-- Email Input -->
                        <div>
                            <label for="email" class="block text-sm font-medium text-slate-700 mb-2">
                                Email
                            </label>
                            <input type="email" id="email" placeholder="seuemail@exemplo.com.br" required
                                class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all" />
                        </div>

                        <!-- Password Input -->
                        <div>
                            <label for="password" class="block text-sm font-medium text-slate-700 mb-2">
                                Senha
                            </label>
                            <div class="relative">
                                <input type="password" id="password" placeholder="••••••••" required
                                    class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all" />
                                <button type="button" onclick="togglePassword()"
                                    class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600">
                                    <span class="material-symbols-outlined" id="eyeIcon">visibility</span>
                                </button>
                            </div>
                            <a href="/reset-password"
                                class="text-sm text-blue-600 hover:text-blue-700 mt-2 inline-block">
                                Esqueceu sua senha?
                            </a>
                        </div>

                        <!-- Error Message -->
                        <div id="errorMessage" class="hidden p-4 bg-red-50 border border-red-200 rounded-lg">
                            <p class="text-sm text-red-600 flex items-center gap-2">
                                <span class="material-symbols-outlined text-lg">error</span>
                                <span id="errorText"></span>
                            </p>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" id="loginButton"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors flex items-center justify-center gap-2">
                            <span id="buttonText">ENTRAR</span>
                            <span id="buttonSpinner" class="hidden">
                                <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none"
                                    viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                        stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor"
                                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                    </path>
                                </svg>
                            </span>
                        </button>
                    </form>

                    <!-- Footer Links -->
                    <div class="mt-6 text-center">
                        <p class="text-sm text-slate-600">
                            Não tem acesso?
                            <a href="/" class="text-blue-600 hover:text-blue-700 font-medium">
                                Solicitar acesso
                            </a>
                        </p>
                    </div>
                </div>

                <!-- Additional Info -->
                <div class="mt-6 text-center">
                    <p class="text-xs text-slate-500">
                        © 2024 WeValid. Todos os direitos reservados.
                    </p>
                </div>
            </div>
        </div>

        <script type="module">
                            import {createClient} from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

                            const SUPABASE_URL = 'https://acensrxfxzqozakkklmy.supabase.co';
                            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFjZW5zcnhmeHpxb3pha2trbG15Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2ODc2NDUsImV4cCI6MjA3OTI2MzY0NX0.rRsWLCmIcoyKkE5Qh_et53wO_xzLriOjrsfU0Rs85Lo';
                            const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

                            // Check if already logged in
                            const {data: {session} } = await supabase.auth.getSession();
                            if (session) {
                                window.location.href = '/dashboard.html';
        }

                            // Toggle password visibility
                            window.togglePassword = function () {
            const passwordInput = document.getElementById('password');
                            const eyeIcon = document.getElementById('eyeIcon');

                            if (passwordInput.type === 'password') {
                                passwordInput.type = 'text';
                            eyeIcon.textContent = 'visibility_off';
            } else {
                                passwordInput.type = 'password';
                            eyeIcon.textContent = 'visibility';
            }
        };

        // Handle form submission
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
                                e.preventDefault();

                            const email = document.getElementById('email').value;
                            const password = document.getElementById('password').value;
                            const errorMessage = document.getElementById('errorMessage');
                            const errorText = document.getElementById('errorText');
                            const loginButton = document.getElementById('loginButton');
                            const buttonText = document.getElementById('buttonText');
                            const buttonSpinner = document.getElementById('buttonSpinner');

                            // Hide previous errors
                            errorMessage.classList.add('hidden');

                            // Show loading state
                            loginButton.disabled = true;
                            buttonText.classList.add('hidden');
                            buttonSpinner.classList.remove('hidden');

                            try {
                const {data, error} = await supabase.auth.signInWithPassword({
                                email: email,
                            password: password,
                });

                            if (error) throw error;

                            // Check if user has franchise access
                            const {data: profile, error: profileError } = await supabase
                            .from('user_profiles')
                            .select('franchise_id, role, status')
                            .eq('id', data.user.id)
                            .single();

                            if (profileError) {
                                console.error('Profile error:', profileError);
                            throw new Error('Erro ao carregar perfil: ' + profileError.message);
                }

                            console.log('User Profile:', profile);

                            if (!profile) {
                    throw new Error('Perfil não encontrado');
                }

                            if (profile.status !== 'approved') {
                    throw new Error('Seu acesso ainda está pendente de aprovação');
                }

                            // Allow admin to login without franchise
                            if (!profile.franchise_id && profile.role !== 'admin') {
                                console.error('Missing franchise_id for role:', profile.role);
                            throw new Error('Usuário sem franquia associada');
                }

                            // Redirect to dashboard
                            window.location.href = '/dashboard.html';

            } catch (error) {
                                console.error('Login error:', error);
                            errorText.textContent = error.message || 'Email ou senha incorretos';
                            errorMessage.classList.remove('hidden');

                            // Reset button state
                            loginButton.disabled = false;
                            buttonText.classList.remove('hidden');
                            buttonSpinner.classList.add('hidden');
            }
        });
        </script>
    </body>

</html>